<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Rigid Registration of Spheres &#8212; Registration Tools 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=2709fde1"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Non-linear registration of growing spheres" href="examples_spheres_growing.html" />
    <link rel="prev" title="Working with Datasets" href="examples_working_with_datasets.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="rigid-registration-of-spheres">
<h1>Rigid Registration of Spheres<a class="headerlink" href="#rigid-registration-of-spheres" title="Link to this heading">¶</a></h1>
<p>This notebook demonstrates how to create, visualize, and rigid register a dataset of spherical images using the <code class="docutils literal notranslate"><span class="pre">registration_tools</span></code> package.</p>
<section id="index">
<h2>Index<a class="headerlink" href="#index" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference internal" href="#rigid-registration-of-spheres"><span class="xref myst">Rigid Registration of Spheres</span></a></p>
<ul>
<li><p><a class="reference internal" href="index.html"><span class="doc std std-doc">Index</span></a></p></li>
<li><p><a class="reference internal" href="#import-the-corresponding-libraries"><span class="xref myst">Import the corresponding libraries</span></a></p></li>
<li><p><a class="reference internal" href="#create-an-artificial-dataset-of-spherical-images"><span class="xref myst">Create an artificial dataset of spherical images</span></a></p>
<ul>
<li><p><a class="reference internal" href="#visualizing"><span class="xref myst">Visualizing</span></a></p></li>
<li><p><a class="reference internal" href="#make-video"><span class="xref myst">Make video</span></a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#register-the-images"><span class="xref myst">Register the images</span></a></p>
<ul>
<li><p><a class="reference internal" href="#check-the-correction-of-the-registered-images"><span class="xref myst">Check the correction of the registered images</span></a></p></li>
<li><p><a class="reference internal" href="#make-videos"><span class="xref myst">Make videos</span></a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</section>
<section id="import-the-corresponding-libraries">
<h2>Import the corresponding libraries<a class="headerlink" href="#import-the-corresponding-libraries" title="Link to this heading">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">napari</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">registration_tools</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rt</span> <span class="c1">#Main package</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">registration_tools.data</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rt_data</span> <span class="c1">#For generating artificial datasets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">registration_tools.visualization</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rt_vis</span> <span class="c1">#For visualization</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">registration_tools.registration</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">rt_reg</span> <span class="c1">#For registration</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">zarr</span>
</pre></div>
</div>
</section>
<section id="create-an-artificial-dataset-of-spherical-images">
<h2>Create an artificial dataset of spherical images<a class="headerlink" href="#create-an-artificial-dataset-of-spherical-images" title="Link to this heading">¶</a></h2>
<p>We will create an artifitcial dataset of 10 spherical images with 3 channels.</p>
<p>By default, if a path is not specified, it will return a <a class="reference external" href="https://zarr.readthedocs.io/en/stable/user-guide/">zarr array</a>. This data type is great for storing big datasets in an eficient way and allow to upload data in memory by batches.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a dataset of spherical images</span>
<span class="n">dataset</span> <span class="o">=</span> <span class="n">rt_data</span><span class="o">.</span><span class="n">sphere</span><span class="p">(</span>
    <span class="n">out</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="c1">#If not specified, a new dataset is created and stored in RAM</span>
    <span class="n">num_images</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">image_size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">num_channels</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">min_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">max_radius</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">jump</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">stride</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Type: &quot;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">dataset</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shape: &quot;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;axis&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Scale: &quot;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;scale&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shape: &quot;</span><span class="p">,</span> <span class="n">dataset</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Type:  &lt;class &#39;zarr.core.array.Array&#39;&gt;
Shape:  TCZYX
Scale:  (1, 1, 1)
Shape:  (10, 3, 50, 50, 50)
</pre></div>
</div>
<section id="visualizing">
<h3>Visualizing<a class="headerlink" href="#visualizing" title="Link to this heading">¶</a></h3>
<p>Initialize the napari viewer to visualize the dataset.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize the napari viewer</span>
<span class="n">viewer</span> <span class="o">=</span> <span class="n">napari</span><span class="o">.</span><span class="n">Viewer</span><span class="p">()</span>
</pre></div>
</div>
<p>and load the dataset to napari. The package provides some helpful functions to plot images generated during the pipeline.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the images in the dataset</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span> <span class="c1">#Clear the viewer of other layers that may be present</span>
<span class="n">rt_vis</span><span class="o">.</span><span class="n">add_image_difference</span><span class="p">(</span><span class="n">viewer</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
<span class="n">rt_vis</span><span class="o">.</span><span class="n">add_image_difference</span><span class="p">(</span><span class="n">viewer</span><span class="p">,</span> <span class="n">dataset</span><span class="p">)</span>
<span class="c1"># viewer.add_image(dataset, scale=dataset.attrs[&quot;scale&quot;]) #This would have been equivalent to the above line.</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">dims</span><span class="o">.</span><span class="n">ndisplay</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
</section>
<section id="make-video">
<h3>Make video<a class="headerlink" href="#make-video" title="Link to this heading">¶</a></h3>
<p>There is a convenient function to create videos from the current display in the napari viewer.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make video</span>
<span class="n">rt_vis</span><span class="o">.</span><span class="n">make_video</span><span class="p">(</span>
    <span class="n">viewer</span><span class="o">=</span><span class="n">viewer</span><span class="p">,</span>
    <span class="n">save_file</span><span class="o">=</span><span class="s1">&#39;sphere_dataset.gif&#39;</span><span class="p">,</span>
    <span class="n">fps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p><img alt="../assets/sphere_dataset.gif" src="_images/sphere_dataset.gif" /></p>
</section>
</section>
<section id="register-the-images">
<h2>Register the images<a class="headerlink" href="#register-the-images" title="Link to this heading">¶</a></h2>
<p>Register the images in the dataset to correct for any misalignments.</p>
<p>First we generate the registration model. There are a few parameters to take into account:</p>
<ol class="arabic simple">
<li><p>Pyramid levels. This indicates the coarse graining (block sizes) that will be used to register the images. The lower the number the smaller the blocks (0 will be pixel size). Smaller numbers will capture finer details but will be slower too.</p></li>
<li><p>Type of transformation (translation, registration, vectorfield…)</p></li>
<li><p>Direction of registration (backward means finding a tranformation from future to past t+1 -&gt; t)</p></li>
<li><p>If to perform global transformation. That is, generate a set of transformations between t -&gt; 0. In our case, since we just want to correct for the movement, we will set it to True.</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Register the video</span>
<span class="n">registration</span> <span class="o">=</span> <span class="n">rt_reg</span><span class="o">.</span><span class="n">Registration</span><span class="p">(</span>
    <span class="n">pyramid_highest_level</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>           <span class="c1">#Higher pyramid level</span>
    <span class="n">pyramid_lowest_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>            <span class="c1">#Lower pyramid level</span>
    <span class="n">registration_type</span><span class="o">=</span><span class="s1">&#39;translation&#39;</span><span class="p">,</span>   <span class="c1">#Type of registration</span>
    <span class="n">registration_direction</span><span class="o">=</span><span class="s1">&#39;backward&#39;</span><span class="p">,</span> <span class="c1">#Direction of registration</span>
    <span class="n">perfom_global_trnsf</span><span class="o">=</span><span class="kc">True</span>           <span class="c1">#Whether to perform global transformation</span>
<span class="p">)</span>
</pre></div>
</div>
<p>And then we apply it to the dataset. We use fit_apply to:</p>
<ol class="arabic simple">
<li><p>Get the transformations.</p></li>
<li><p>Apply the transformations to the dataset.</p></li>
</ol>
<p>The registration method can only work with one channel. If the data has different channels, you should specify which channel it should use for registering the data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dataset_registered</span> <span class="o">=</span> <span class="n">registration</span><span class="o">.</span><span class="n">fit_apply</span><span class="p">(</span>    
    <span class="n">dataset</span><span class="o">=</span><span class="n">dataset</span><span class="p">,</span>
    <span class="n">use_channel</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>     <span class="c1">#Which channel to use for the registration.</span>
    <span class="n">out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>          <span class="c1">#If not specified, a new dataset is created and stored in RAM</span>
<span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Registering images using channel 0: 100%|██████████| 9/9 [00:00&lt;00:00, 141.06/s]
Applying registration to images: 100%|██████████| 9/9 [00:00&lt;00:00, 192.57/s]
</pre></div>
</div>
<section id="check-the-correction-of-the-registered-images">
<h3>Check the correction of the registered images<a class="headerlink" href="#check-the-correction-of-the-registered-images" title="Link to this heading">¶</a></h3>
<p>For that, we plot the original dataset and the registered one.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make video projections</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span> <span class="c1"># Clear the viewer from past images</span>
<span class="n">rt_vis</span><span class="o">.</span><span class="n">add_image</span><span class="p">(</span><span class="n">viewer</span><span class="p">,</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;t0&quot;</span><span class="p">)</span>
<span class="n">rt_vis</span><span class="o">.</span><span class="n">add_image</span><span class="p">(</span><span class="n">viewer</span><span class="p">,</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dataset&quot;</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
<span class="n">rt_vis</span><span class="o">.</span><span class="n">add_image</span><span class="p">(</span><span class="n">viewer</span><span class="p">,</span> <span class="n">dataset_registered</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">colormap</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;dataset_registered&quot;</span><span class="p">)</span>
<span class="n">viewer</span><span class="o">.</span><span class="n">dims</span><span class="o">.</span><span class="n">ndisplay</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
</section>
<section id="make-videos">
<h3>Make videos<a class="headerlink" href="#make-videos" title="Link to this heading">¶</a></h3>
<p>Now that we checked that the correction is satisfactory, we can save the video.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make video registered</span>
<span class="n">rt_vis</span><span class="o">.</span><span class="n">make_video</span><span class="p">(</span>
    <span class="n">viewer</span><span class="o">=</span><span class="n">viewer</span><span class="p">,</span>
    <span class="n">save_file</span><span class="o">=</span><span class="s1">&#39;sphere_dataset_registered.gif&#39;</span><span class="p">,</span>
    <span class="n">fps</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p><img alt="../assets/sphere_dataset_registered.gif" src="_images/sphere_dataset_registered.gif" /></p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">Registration Tools</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="examples_working_with_datasets.html">Working with Datasets</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Rigid Registration of Spheres</a></li>
<li class="toctree-l2"><a class="reference internal" href="examples_spheres_growing.html">Non-linear registration of growing spheres</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="API.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="examples.html">Examples</a><ul>
      <li>Previous: <a href="examples_working_with_datasets.html" title="previous chapter">Working with Datasets</a></li>
      <li>Next: <a href="examples_spheres_growing.html" title="next chapter">Non-linear registration of growing spheres</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.1</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/examples_spheres.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>